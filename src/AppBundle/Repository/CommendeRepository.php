<?php

namespace AppBundle\Repository;
use AppBundle\Entity\PointVente; 
use AppBundle\Entity\User; 
/**
 * CommendeRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class CommendeRepository extends \Doctrine\ORM\EntityRepository
{
	  	

   public function findCommendes(User $user=null,PointVente $pointVente=null, $startDate=null, $endDate=null,$keys=[0]){
           $qb = $this->createQueryBuilder('c');
          if($user!=null){
            $qb->join('c.user','u');
         if (!$user->isMe()) {
             $qb->andWhere('c.user=:user')->setParameter('user', $user);
        }else
             $qb->andWhere('u.parent=:parent')->setParameter('parent', $user);
            } 
          if($pointVente!=null){
            $qb->andWhere('c.pointVente=:pointVente')
             ->setParameter('pointVente', $pointVente);
            }       
           
          if($startDate!=null){
               $qb->andWhere('c.date>=:startDate')
              ->setParameter('startDate', new \DateTime($startDate));
            }
          if($endDate!=null){
             $qb->andWhere('c.date<=:endDate')
             ->setParameter('endDate',new \DateTime($endDate));
            } 
            $qb->andWhere($qb->expr()->notIn('c.id', $keys))
            ->orderBy('c.date','asc');
         return $qb->getQuery()->getResult();  
  }


}
